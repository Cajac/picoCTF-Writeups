# login

- [Challenge information](#challenge-information)
- [Solution](#solution)
- [References](#references)

## Challenge information
```
Points: 100
Tags: picoMini by redpwn, Web Exploitation
Author: BROWNIEINMOTION

Description:
My dog-sitter's brother made this website but I can't get in; can you help?

login.mars.picoctf.net

Hints:
(None)
```
Challenge link: [https://play.picoctf.org/practice/challenge/200](https://play.picoctf.org/practice/challenge/200)

## Solution

Let's start by browsing to the web site and check the HTML source code.  
Press `CTRL + U ` or right-click anywhere on the background and select `View page source`

```html
<!doctype html>
<html>
    <head>
        <link rel="stylesheet" href="styles.css">
        <script src="index.js"></script>
    </head>
    <body>
        <div>
          <h1>Login</h1>
          <form method="POST">
            <label for="username">Username</label>
            <input name="username" type="text"/>
            <label for="username">Password</label>
            <input name="password" type="password"/>
            <input type="submit" value="Submit"/>
          </form>
        </div>
    </body>
</html>
```

Nothing much to see there. But there is also a `index.js` script. Lets check that
```javascript
(async () => {
    await new Promise((e => window.addEventListener("load", e))), document.querySelector("form").addEventListener("submit", (e => {
        e.preventDefault();
        const r = {
                u: "input[name=username]",
                p: "input[name=password]"
            },
            t = {};
        for (const e in r) t[e] = btoa(document.querySelector(r[e]).value).replace(/=/g, "");
        return "YWRtaW4" !== t.u ? alert("Incorrect Username") : "cGljb0NURns1M3J2M3JfNTNydjNyXzUzcnYzcl81M3J2M3JfNTNydjNyfQ" !== t.p ? alert("Incorrect Password") : void alert(`Correct Password! Your flag is ${atob(t.p)}.`)
    }))
})();
```

I used an online beautifier called [js-beautify](https://beautifier.io/) to make the code more readable.

The long gibberish password string `cGljb0NURns1M3J2M3JfNTNydjNyXzUzcnYzcl81M3J2M3JfNTNydjNyfQ` looks like it's [base64](https://en.wikipedia.org/wiki/Base64) encoded.

We can use either [CyberChefs 'From Base64' recipe](https://gchq.github.io/CyberChef/#recipe=From_Base64('A-Za-z0-9-_',true,false)) or `base64` as shown below to decode it.
```bash
┌──(kali㉿kali)-[/mnt/…/picoCTF/picoMini_by_redpwn/Web_Exploitation/login]
└─$ echo "cGljb0NURns1M3J2M3JfNTNydjNyXzUzcnYzcl81M3J2M3JfNTNydjNyfQ" | base64 -d  
picoCTF{<REDACTED>}base64: invalid input
```

We clearly see the flag (redacted here) but we also get an error message.  
This is because the string has an invalid length. If we add padding (two '=' chars), it is properly decoded
```bash
┌──(kali㉿kali)-[/mnt/…/picoCTF/picoMini_by_redpwn/Web_Exploitation/login]
└─$ echo "cGljb0NURns1M3J2M3JfNTNydjNyXzUzcnYzcl81M3J2M3JfNTNydjNyfQ==" | base64 -d
picoCTF{<REDACTED>} 
```

For additional information, please see the references below.

### References

- [Wikipedia - Base64](https://en.wikipedia.org/wiki/Base64)
