# Mini RSA

- [Challenge information](#challenge-information)
- [Solution](#solution)
- [References](#references)

## Challenge information
```
Points: 70
Tags: picoCTF 2021, Cryptography
Author: SARA

Description:
What happens if you have a small exponent? 

There is a twist though, we padded the plaintext so that (M ** e) is just barely larger than N. 
Let's decrypt this: ciphertext
 
Hints:
1. RSA tutorial - https://en.wikipedia.org/wiki/RSA_(cryptosystem)
2. How could having too small of an e affect the security of this key?
3. Make sure you don't lose precision, the numbers are pretty big (besides the e value)
4. You shouldn't have to make too many guesses
5. pico is in the flag, but not at the beginning
```

## Solution

### Analyse the setup

Lets start by analysing what we have
```
N: 1615765684321463054078226051959887884233678317734892901740763321135213636796075462401950274602405095138589898087428337758445013281488966866073355710771864671726991918706558071231266976427184673800225254531695928541272546385146495736420261815693810544589811104967829354461491178200126099661909654163542661541699404839644035177445092988952614918424317082380174383819025585076206641993479326576180793544321194357018916215113009742654408597083724508169216182008449693917227497813165444372201517541788989925461711067825681947947471001390843774746442699739386923285801022685451221261010798837646928092277556198145662924691803032880040492762442561497760689933601781401617086600593482127465655390841361154025890679757514060456103104199255917164678161972735858939464790960448345988941481499050248673128656508055285037090026439683847266536283160142071643015434813473463469733112182328678706702116054036618277506997666534567846763938692335069955755244438415377933440029498378955355877502743215305768814857864433151287
e: 3

ciphertext (c): 1220012318588871886132524757898884422174534558055593713309088304910273991073554732659977133980685370899257850121970812405700793710546674062154237544840177616746805668666317481140872605653768484867292138139949076102907399831998827567645230986345455915692863094364797526497302082734955903755050638155202890599808154521995312832362835648711819155169679435239286935784452613518014043549023137530689967601174246864606495200453313556091158637122956278811935858649498244722557014003601909465057421728834883411992999408157828996722087360414577252630186866387785481057649036414986099181831292644783916873710123009473008639825720434282893177856511819939659625989092206115515005188455003918918879483234969164887705505900695379846159901322053253156096586139847768297521166448931631916220211254417971683366167719596219422776768895460908015773369743067718890024592505393221967098308653507944367482969331133726958321767736855857529350486000867434567743580745186277999637935034821461543527421831665171525793988229518569050
```

So we have a modulus number `N`,  the public key exponent `e`, and the cipher text `c`.

Remember that in RSA `M**3 mod n = c`. We can rewrite this as `M**3 = i*n + c`  for some value of `i`.  
This means that `M = iroot(i*n+c, 3)` for some `i`. We just need to find the correct `i` value.

We will use the `iroot` function from [gmpy2 module](https://pypi.org/project/gmpy2/).  
From the [manpage](https://manpages.ubuntu.com/manpages/trusty/man3/gmpy2.3.html)
```
       iroot(...)
              iroot(x,n) returns a 2-element tuple (y, b) such that y is the integer n-th root of
              x and b is True if the root is exact. x must be >= 0 and n must be > 0.
```

### Write a solve script

This Python script will search for the correct value of `i`
```python
#!/usr/bin/python

from gmpy2 import iroot

# Given in the challenge
N = 1615765684321463054078226051959887884233678317734892901740763321135213636796075462401950274602405095138589898087428337758445013281488966866073355710771864671726991918706558071231266976427184673800225254531695928541272546385146495736420261815693810544589811104967829354461491178200126099661909654163542661541699404839644035177445092988952614918424317082380174383819025585076206641993479326576180793544321194357018916215113009742654408597083724508169216182008449693917227497813165444372201517541788989925461711067825681947947471001390843774746442699739386923285801022685451221261010798837646928092277556198145662924691803032880040492762442561497760689933601781401617086600593482127465655390841361154025890679757514060456103104199255917164678161972735858939464790960448345988941481499050248673128656508055285037090026439683847266536283160142071643015434813473463469733112182328678706702116054036618277506997666534567846763938692335069955755244438415377933440029498378955355877502743215305768814857864433151287
e = 3
c = 1220012318588871886132524757898884422174534558055593713309088304910273991073554732659977133980685370899257850121970812405700793710546674062154237544840177616746805668666317481140872605653768484867292138139949076102907399831998827567645230986345455915692863094364797526497302082734955903755050638155202890599808154521995312832362835648711819155169679435239286935784452613518014043549023137530689967601174246864606495200453313556091158637122956278811935858649498244722557014003601909465057421728834883411992999408157828996722087360414577252630186866387785481057649036414986099181831292644783916873710123009473008639825720434282893177856511819939659625989092206115515005188455003918918879483234969164887705505900695379846159901322053253156096586139847768297521166448931631916220211254417971683366167719596219422776768895460908015773369743067718890024592505393221967098308653507944367482969331133726958321767736855857529350486000867434567743580745186277999637935034821461543527421831665171525793988229518569050

for i in range(5000):
    m, exact_root = iroot(i*N + c, e)
    if exact_root:
        print(f"Found i: {i}")
        msg = bytes.fromhex(format(m, 'x')).decode()
        print(f"Found Msg: {msg}")
        break
```

### Get the flag

The we run the script to get the flag
```bash
┌──(kali㉿kali)-[/mnt/…/picoCTF/picoCTF_2021/Cryptography/Mini_RSA]
└─$ ~/python_venvs/gmpy2/bin/python solve.py
Found i: 3533
Found Msg:                                                                                                         picoCTF{e_sh0u1d_<REDACTED>}
```

And there we have the flag.

For additional information, please see the references below.

## References

- [Wikipedia - RSA (cryptosystem)](https://en.wikipedia.org/wiki/RSA_(cryptosystem))
- [The RSA Cryptosystem - Concepts](https://cryptobook.nakov.com/asymmetric-key-ciphers/the-rsa-cryptosystem-concepts)
