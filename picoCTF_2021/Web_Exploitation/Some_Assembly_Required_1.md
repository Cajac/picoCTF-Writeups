# Some Assembly Required 1

- [Challenge information](#challenge-information)
- [Solution](#solution)
- [References](#references)

## Challenge information
```
Points: 70
Tags: picoCTF 2021, Web Exploitation
Author: SEARS SCHULZ
 
Description:
http://mercury.picoctf.net:26318/index.html

Hints:
(None)
```

## Solution

The challenge name suggests that we should look for [WebAssembly](https://en.wikipedia.org/wiki/WebAssembly).

### Analyse the source code

Browse to the web site and then right-click and select 'View page source'.
We get a very short HTML page
```html
<html>
<head>
	<meta charset="UTF-8">
	<script src="G82XCw5CX3.js"></script>
</head>
<body>
	<h4>Enter flag:</h4>
	<input type="text" id="input"/>
	<button onclick="onButtonPress()">Submit</button>
	<p id="result"></p>
</body>
</html>
```

Click on the link to `G82XCw5CX3.js` to investigate the javascript source
```javascript
const _0x402c=['value','2wfTpTR','instantiate','275341bEPcme','innerHTML','1195047NznhZg','1qfevql','input','1699808QuoWhA','Correct!','check_flag','Incorrect!','./JIFxzHyW8W','23SMpAuA','802698XOMSrr','charCodeAt','474547vVoGDO','getElementById','instance','copy_char','43591XxcWUl','504454llVtzW','arrayBuffer','2NIQmVj','result'];const _0x4e0e=function(_0x553839,_0x53c021){_0x553839=_0x553839-0x1d6;let _0x402c6f=_0x402c[_0x553839];return _0x402c6f;};(function(_0x76dd13,_0x3dfcae){const _0x371ac6=_0x4e0e;while(!![]){try{const _0x478583=-parseInt(_0x371ac6(0x1eb))+parseInt(_0x371ac6(0x1ed))+-parseInt(_0x371ac6(0x1db))*-parseInt(_0x371ac6(0x1d9))+-parseInt(_0x371ac6(0x1e2))*-parseInt(_0x371ac6(0x1e3))+-parseInt(_0x371ac6(0x1de))*parseInt(_0x371ac6(0x1e0))+parseInt(_0x371ac6(0x1d8))*parseInt(_0x371ac6(0x1ea))+-parseInt(_0x371ac6(0x1e5));if(_0x478583===_0x3dfcae)break;else _0x76dd13['push'](_0x76dd13['shift']());}catch(_0x41d31a){_0x76dd13['push'](_0x76dd13['shift']());}}}(_0x402c,0x994c3));let exports;(async()=>{const _0x48c3be=_0x4e0e;let _0x5f0229=await fetch(_0x48c3be(0x1e9)),_0x1d99e9=await WebAssembly[_0x48c3be(0x1df)](await _0x5f0229[_0x48c3be(0x1da)]()),_0x1f8628=_0x1d99e9[_0x48c3be(0x1d6)];exports=_0x1f8628['exports'];})();function onButtonPress(){const _0xa80748=_0x4e0e;let _0x3761f8=document['getElementById'](_0xa80748(0x1e4))[_0xa80748(0x1dd)];for(let _0x16c626=0x0;_0x16c626<_0x3761f8['length'];_0x16c626++){exports[_0xa80748(0x1d7)](_0x3761f8[_0xa80748(0x1ec)](_0x16c626),_0x16c626);}exports['copy_char'](0x0,_0x3761f8['length']),exports[_0xa80748(0x1e7)]()==0x1?document[_0xa80748(0x1ee)](_0xa80748(0x1dc))[_0xa80748(0x1e1)]=_0xa80748(0x1e6):document[_0xa80748(0x1ee)](_0xa80748(0x1dc))[_0xa80748(0x1e1)]=_0xa80748(0x1e8);}
```

Hhm, a bit obfuscated but we see a number of interesting strings in the `_0x402c` array
 * input 
 * Correct!
 * check_flag
 * Incorrect!
 * ./JIFxzHyW8W (looks like a relative path)
 * charCodeAt
 * getElementById
 * instance

Further down we also see `WebAssembly`.

### Get the WebAssembly file

Lets retreive and analyse the file called `JIFxzHyW8W`
```bash
┌──(kali㉿kali)-[/mnt/…/picoCTF/picoCTF_2021/Web_Exploitation/Some_Assembly_Required_1]
└─$ wget http://mercury.picoctf.net:26318/JIFxzHyW8W
--2023-08-22 03:02:29--  http://mercury.picoctf.net:26318/JIFxzHyW8W
Resolving mercury.picoctf.net (mercury.picoctf.net)... 18.189.209.142
Connecting to mercury.picoctf.net (mercury.picoctf.net)|18.189.209.142|:26318... connected.
HTTP request sent, awaiting response... 200 OK
Length: 824
Saving to: ‘JIFxzHyW8W’

JIFxzHyW8W                               100%[===============================================================================>]     824  --.-KB/s    in 0s      

2023-08-22 03:02:29 (26.1 MB/s) - ‘JIFxzHyW8W’ saved [824/824]

┌──(kali㉿kali)-[/mnt/…/picoCTF/picoCTF_2021/Web_Exploitation/Some_Assembly_Required_1]
└─$ file JIFxzHyW8W                                                     
JIFxzHyW8W: WebAssembly (wasm) binary module version 0x1 (MVP)
```

### Get the flag

As stated by `file` it is in the [binary format](https://webassembly.github.io/spec/core/binary/index.html) but we can always check for strings
```bash
┌──(kali㉿kali)-[/mnt/…/picoCTF/picoCTF_2021/Web_Exploitation/Some_Assembly_Required_1]
└─$ strings -n 8 JIFxzHyW8W  
__wasm_call_ctors
check_flag
        copy_char
__dso_handle
__data_end
__global_base
__heap_base
__memory_base
__table_base
!" ! "q!# #
!% $ %q!& 
!( ' (q!) & )k!* 
+picoCTF{<REDACTED>}
```

Ah, how nice, there we have the flag.

For additional information, please see the references below.

## References

- [Wikipedia - WebAssembly](https://en.wikipedia.org/wiki/WebAssembly)
- [MDN - WebAssembly](https://developer.mozilla.org/en-US/docs/WebAssembly)
- [WebAssembly - binary format](https://webassembly.github.io/spec/core/binary/index.html)
